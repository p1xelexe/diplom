<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Просмотр заявки - Система учета услуг ЖКХ</title>
</head>
<body>
<div th:replace="~{layout/main :: body(content=~{::main}, title='Просмотр заявки - Система учета услуг ЖКХ')}">
    <main>
        <h2>Просмотр заявки №<span th:text="${request.id}">1</span></h2>

        <div class="row mt-4">
            <div class="col-md-8 offset-md-2">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Детали заявки</h5>
                            <span class="badge"
                                  th:classappend="${
                                        request.status.name() == 'NEW' ? 'bg-danger' :
                                        request.status.name() == 'IN_PROGRESS' ? 'bg-warning' :
                                        request.status.name() == 'COMPLETED' ? 'bg-success' : 'bg-secondary'
                                      }"
                                  th:text="${request.status.displayName}">
                                    Статус
                                </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <dl class="row">
                            <dt class="col-sm-3">Помещение:</dt>
                            <dd class="col-sm-9" th:text="${request.apartment.identifier + ' (' + request.apartment.address + ')'}">
                                Кв. 123 (ул. Примерная, д. 1)
                            </dd>

                            <dt class="col-sm-3">Дата создания:</dt>
                            <dd class="col-sm-9" th:text="${#temporals.format(request.createdAt, 'dd.MM.yyyy HH:mm')}">
                                01.01.2025 12:00
                            </dd>

                            <dt class="col-sm-3">Дата выполнения:</dt>
                            <dd class="col-sm-9">
                                    <span th:if="${request.completedAt != null}"
                                          th:text="${#temporals.format(request.completedAt, 'dd.MM.yyyy HH:mm')}">
                                        02.01.2025 15:30
                                    </span>
                                <span th:if="${request.completedAt == null}" class="text-muted">Не выполнено</span>
                            </dd>

                            <dt class="col-sm-3">Описание:</dt>
                            <dd class="col-sm-9" th:text="${request.description}">
                                Описание проблемы...
                            </dd>

                            <dt class="col-sm-3" th:if="${request.comment != null}">Комментарий:</dt>
                            <dd class="col-sm-9" th:if="${request.comment != null}" th:text="${request.comment}">
                                Комментарий исполнителя...
                            </dd>
                        </dl>

                        <!-- Форма обновления статуса для сотрудников -->
                        <div class="mt-4" sec:authorize="hasAnyRole('EMPLOYEE', 'ADMIN')">
                            <hr>
                            <h6>Обновить статус заявки</h6>
                            <form th:action="@{/requests/{id}/update-status(id=${request.id})}" method="post">
                                <div class="row g-3">
                                    <div class="col-md-5">
                                        <select class="form-select" name="status">
                                            <option th:each="status : ${statuses}"
                                                    th:value="${status}"
                                                    th:text="${status.displayName}"
                                                    th:selected="${request.status == status}">
                                                Статус
                                            </option>
                                        </select>
                                    </div>
                                    <div class="col-md-5">
                                        <input type="text" class="form-control" name="comment" placeholder="Комментарий">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-primary w-100">Сохранить</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="mt-4">
                            <a th:href="@{/requests}" class="btn btn-secondary">Назад к списку заявок</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>